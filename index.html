<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
    <link rel="stylesheet" href="css/L.Control.Locate.min.css">
    <link rel="stylesheet" href="css/qgis2web.css">
    <link rel="stylesheet" href="css/fontawesome-all.min.css">
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }

        .flexbox {
            display: flex;
            height: 100%;
        }

        .srwk-flag {
            width: 80%;
            height: 13.5%;
            padding-top: 10px;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }

        main {
            width: 85%;
        }

        .sidebar {
            width: 15%;
            background-color: #F7DC6F;
            height: 100%;
        }

        .sidebar ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .sidebar li a {
            display: block;
            color: #333;
            padding: 16px 25px;
            text-decoration: none;
            border-bottom: 1px solid #ccc;
        }

        .sidebar li a:hover {
            background-color: #F2C464;
            color: #333;
        }

        .sidebar li a i {
            margin-right: 10px;
        }

        .sidebar>header {
            width: 100%;
            text-align: center;
            font-size: 24px;
            font-weight: bolder;
        }

        .info-popup {
            position: absolute;
            background-color: #f9f9f9;
            padding: 10px;
            border: 1px solid #ccc;
            width: 275px;
            z-index: 1;
            opacity: 0;
            transform: translateY(-100%);
            transition: opacity 0.5s, transform 0.5s;
            pointer-events: none;
        }

        .info-link:hover+.info-popup {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }

        .info-link:not(:hover)+.info-popup {
            opacity: 0;
            transform: translateY(100%);
            transition: opacity 1s ease-in-out, transform 1s ease-in-out;
            pointer-events: none;
        }

        .address-table-container {
            height: 20%;
            background-color: #F5F5F5;
            overflow-y: scroll;
        }

        #address-table {
            width: 100%;
            border: 1px solid #ccc;
            border-collapse: collapse;
            margin-bottom: 10px;
        }

        #address-table thead {
            position: sticky;
            top: 0;
            background-color: #FF9800;
            color: #333333;
            font-weight: bold;
        }

        #address-table thead #address-table tbody {
            overflow-y: scroll;
            height: 100%;
        }

        #address-table tbody tr {
            background-color: #F5F5F5;
        }

        #address-table th,
        #address-table td {
            padding: 10px;
            border: 1px solid #ccc;
            text-align: left;
        }

        #address-table td {
            color: #333333;
        }

        #address-table a {
            color: #333333;
        }

        #address-table a:hover {
            color: rgba(255, 0, 0, 0.603);
        }

        #map {
            width: 100%;
            height: 80%;
            padding: 0;
            margin: 0;
        }
    </style>
    <title>Sarawak Savvy</title>
</head>

<body>
    <section class="flexbox">
        <nav class="sidebar">
            <img src="./css/images/flag.png" alt="flag of Sarawak" class="srwk-flag">
            <header>
                <h1>Sarawak Savvy</h1>
            </header>
            <ul>
                <li>
                    <a href="#" class="info-link">Information</a>
                    <div class="info-popup">
                        <p>1. Welcome to Sarawak Savvy! This page provides an interactive map of Sarawak, Malaysia.</p>
                        <p>2. To navigate the map, use the zoom controls in the top left corner or click and drag the
                            map to
                            pan.</p>
                        <p>3. Click on a location to view more information about that area.</p>
                        <p>4. Use the layer control in the top right corner to toggle different layers of information on
                            and
                            off.</p>
                        <p>5. Click the location icon on the top left corner to access your current location.</p>
                    </div>
                </li>
                <li><a href="#">Weather</a></li>
                <li><a href="#">Grocery</a></li>
            </ul>
            <div>

            </div>
        </nav>
        <main>
            <div id="map">
            </div>
            <div class="address-table-container">
                <table id="address-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Address</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="address-table-content">
                        <tr>
                            <td>NA</td>
                            <td>NA</td>
                            <td>NA</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </section>
    <script src="js/qgis2web_expressions.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="js/L.Control.Layers.Tree.min.js"></script>
    <script src="js/L.Control.Locate.min.js"></script>
    <script src="js/leaflet.rotatedMarker.js"></script>
    <script src="js/leaflet.pattern.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/rbush.min.js"></script>
    <script src="js/labelgun.min.js"></script>
    <script src="js/labels.js"></script>
    <script src="data/Poverty_2.js"></script>
    <script src="data/Income_3.js"></script>
    <script src="data/Populations_4.js"></script>
    <script src="data/ResidentialArea_5.js"></script>
    <script src="data/UrbanArea_6.js"></script>
    <script src="data/Sarawak_7.js"></script>
    <script src="data/Districts_8.js"></script>
    <script src="data/Grocery_Retailers_9.js"></script>
    <script>
        var highlightLayer;
        function highlightFeature(e) {
            highlightLayer = e.target;
            highlightLayer.openPopup();
        }
        var map = L.map('map', {
            zoomControl: false, maxZoom: 28, minZoom: 1
        }).fitBounds([[0.9713853786696103, 110.60812527467544], [4.014221522860646, 115.05539867958812]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({ truncate: { length: 30, location: 'smart' } });
        // remove popup's row if "visible-with-data"
        function removeEmptyRowsFromPopupContent(content, feature) {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            var rows = tempDiv.querySelectorAll('tr');
            for (var i = 0; i < rows.length; i++) {
                var td = rows[i].querySelector('td.visible-with-data');
                var key = td ? td.id : '';
                if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                    rows[i].parentNode.removeChild(rows[i]);
                }
            }
            return tempDiv.innerHTML;
        }
        // add class to format popup if it contains media
        function addClassToPopupIfMedia(content, popup) {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            if (tempDiv.querySelector('td img')) {
                popup._contentNode.classList.add('media');
                // Delay to force the redraw
                setTimeout(function () {
                    popup.update();
                }, 10);
            } else {
                popup._contentNode.classList.remove('media');
            }
        }
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);
        L.control.locate({ locateOptions: { maxZoom: 19 } }).addTo(map);
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        map.createPane('pane_OpenStreetMap_0');
        map.getPane('pane_OpenStreetMap_0').style.zIndex = 400;
        var layer_OpenStreetMap_0 = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            pane: 'pane_OpenStreetMap_0',
            opacity: 1.0,
            attribution: '',
            minZoom: 1,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 19
        });
        layer_OpenStreetMap_0;
        map.addLayer(layer_OpenStreetMap_0);
        map.createPane('pane_HeatMapFoodDesert_1');
        map.getPane('pane_HeatMapFoodDesert_1').style.zIndex = 401;
        var img_HeatMapFoodDesert_1 = 'data/HeatMapFoodDesert_1.png';
        var img_bounds_HeatMapFoodDesert_1 = [[0.857509404, 109.543910856], [5.106540698, 115.670421094]];
        var layer_HeatMapFoodDesert_1 = new L.imageOverlay(img_HeatMapFoodDesert_1,
            img_bounds_HeatMapFoodDesert_1,
            { pane: 'pane_HeatMapFoodDesert_1' });
        bounds_group.addLayer(layer_HeatMapFoodDesert_1);
        function pop_Poverty_2(feature, layer) {
            layer.on({
                mouseout: function (e) {
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function (feature) {
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">name</th>\
                        <td class="visible-with-data" id="name">' + (feature.properties['name'] !== null ? autolinker.link(feature.properties['name'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">AbsPoverty</th>\
                        <td class="visible-with-data" id="AbsPoverty">' + (feature.properties['AbsPoverty'] !== null ? autolinker.link(feature.properties['AbsPoverty'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
            layer.on('popupopen', function (e) {
                addClassToPopupIfMedia(content, e.popup);
            });
            layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Poverty_2_0(feature) {
            if (feature.properties['AbsPoverty'] >= 2.100000 && feature.properties['AbsPoverty'] <= 6.000000) {
                return {
                    pane: 'pane_Poverty_2',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(255,245,240,1.0)',
                    interactive: true,
                }
            }
            if (feature.properties['AbsPoverty'] >= 6.000000 && feature.properties['AbsPoverty'] <= 9.600000) {
                return {
                    pane: 'pane_Poverty_2',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(252,190,165,1.0)',
                    interactive: true,
                }
            }
            if (feature.properties['AbsPoverty'] >= 9.600000 && feature.properties['AbsPoverty'] <= 13.600000) {
                return {
                    pane: 'pane_Poverty_2',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(251,112,80,1.0)',
                    interactive: true,
                }
            }
            if (feature.properties['AbsPoverty'] >= 13.600000 && feature.properties['AbsPoverty'] <= 20.000000) {
                return {
                    pane: 'pane_Poverty_2',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(211,32,32,1.0)',
                    interactive: true,
                }
            }
            if (feature.properties['AbsPoverty'] >= 20.000000 && feature.properties['AbsPoverty'] <= 38.600000) {
                return {
                    pane: 'pane_Poverty_2',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(103,0,13,1.0)',
                    interactive: true,
                }
            }
        }
        map.createPane('pane_Poverty_2');
        map.getPane('pane_Poverty_2').style.zIndex = 402;
        map.getPane('pane_Poverty_2').style['mix-blend-mode'] = 'normal';
        var layer_Poverty_2 = new L.geoJson(json_Poverty_2, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Poverty_2',
            layerName: 'layer_Poverty_2',
            pane: 'pane_Poverty_2',
            onEachFeature: pop_Poverty_2,
            style: style_Poverty_2_0,
        });
        bounds_group.addLayer(layer_Poverty_2);
        function pop_Income_3(feature, layer) {
            layer.on({
                mouseout: function (e) {
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function (feature) {
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">name</th>\
                        <td class="visible-with-data" id="name">' + (feature.properties['name'] !== null ? autolinker.link(feature.properties['name'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">MeanIncome</th>\
                        <td class="visible-with-data" id="MeanIncome">' + (feature.properties['MeanIncome'] !== null ? autolinker.link(feature.properties['MeanIncome'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
            layer.on('popupopen', function (e) {
                addClassToPopupIfMedia(content, e.popup);
            });
            layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Income_3_0(feature) {
            if (feature.properties['MeanIncome'] >= 3218.000000 && feature.properties['MeanIncome'] <= 4002.000000) {
                return {
                    pane: 'pane_Income_3',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(255,245,235,1.0)',
                    interactive: true,
                }
            }
            if (feature.properties['MeanIncome'] >= 4002.000000 && feature.properties['MeanIncome'] <= 4368.000000) {
                return {
                    pane: 'pane_Income_3',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(253,210,165,1.0)',
                    interactive: true,
                }
            }
            if (feature.properties['MeanIncome'] >= 4368.000000 && feature.properties['MeanIncome'] <= 4881.000000) {
                return {
                    pane: 'pane_Income_3',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(253,146,67,1.0)',
                    interactive: true,
                }
            }
            if (feature.properties['MeanIncome'] >= 4881.000000 && feature.properties['MeanIncome'] <= 5621.000000) {
                return {
                    pane: 'pane_Income_3',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(223,80,5,1.0)',
                    interactive: true,
                }
            }
            if (feature.properties['MeanIncome'] >= 5621.000000 && feature.properties['MeanIncome'] <= 9645.000000) {
                return {
                    pane: 'pane_Income_3',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(127,39,4,1.0)',
                    interactive: true,
                }
            }
        }
        map.createPane('pane_Income_3');
        map.getPane('pane_Income_3').style.zIndex = 403;
        map.getPane('pane_Income_3').style['mix-blend-mode'] = 'normal';
        var layer_Income_3 = new L.geoJson(json_Income_3, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Income_3',
            layerName: 'layer_Income_3',
            pane: 'pane_Income_3',
            onEachFeature: pop_Income_3,
            style: style_Income_3_0,
        });
        bounds_group.addLayer(layer_Income_3);
        function pop_Populations_4(feature, layer) {
            layer.on({
                mouseout: function (e) {
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function (feature) {
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">name</th>\
                        <td class="visible-with-data" id="name">' + (feature.properties['name'] !== null ? autolinker.link(feature.properties['name'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Population</th>\
                        <td class="visible-with-data" id="Population">' + (feature.properties['Population'] !== null ? autolinker.link(feature.properties['Population'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
            layer.on('popupopen', function (e) {
                addClassToPopupIfMedia(content, e.popup);
            });
            layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Populations_4_0(feature) {
            if (feature.properties['Population'] >= 8.000000 && feature.properties['Population'] <= 18.900000) {
                return {
                    pane: 'pane_Populations_4',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(247,251,255,1.0)',
                    interactive: true,
                }
            }
            if (feature.properties['Population'] >= 18.900000 && feature.properties['Population'] <= 24.600000) {
                return {
                    pane: 'pane_Populations_4',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(200,220,240,1.0)',
                    interactive: true,
                }
            }
            if (feature.properties['Population'] >= 24.600000 && feature.properties['Population'] <= 36.700000) {
                return {
                    pane: 'pane_Populations_4',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(115,178,216,1.0)',
                    interactive: true,
                }
            }
            if (feature.properties['Population'] >= 36.700000 && feature.properties['Population'] <= 57.100000) {
                return {
                    pane: 'pane_Populations_4',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(41,121,185,1.0)',
                    interactive: true,
                }
            }
            if (feature.properties['Population'] >= 57.100000 && feature.properties['Population'] <= 621.700000) {
                return {
                    pane: 'pane_Populations_4',
                    opacity: 1,
                    color: 'rgba(35,35,35,1.0)',
                    dashArray: '',
                    lineCap: 'butt',
                    lineJoin: 'miter',
                    weight: 1.0,
                    fill: true,
                    fillOpacity: 1,
                    fillColor: 'rgba(8,48,107,1.0)',
                    interactive: true,
                }
            }
        }
        map.createPane('pane_Populations_4');
        map.getPane('pane_Populations_4').style.zIndex = 404;
        map.getPane('pane_Populations_4').style['mix-blend-mode'] = 'normal';
        var layer_Populations_4 = new L.geoJson(json_Populations_4, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Populations_4',
            layerName: 'layer_Populations_4',
            pane: 'pane_Populations_4',
            onEachFeature: pop_Populations_4,
            style: style_Populations_4_0,
        });
        bounds_group.addLayer(layer_Populations_4);
        function pop_ResidentialArea_5(feature, layer) {
            layer.on({
                mouseout: function (e) {
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function (feature) {
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fid'] !== null ? autolinker.link(feature.properties['fid'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['osm_id'] !== null ? autolinker.link(feature.properties['osm_id'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['code'] !== null ? autolinker.link(feature.properties['code'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['fclass'] !== null ? autolinker.link(feature.properties['fclass'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name'] !== null ? autolinker.link(feature.properties['name'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
            layer.on('popupopen', function (e) {
                addClassToPopupIfMedia(content, e.popup);
            });
            layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_ResidentialArea_5_0() {
            return {
                pane: 'pane_ResidentialArea_5',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(152,125,183,1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_ResidentialArea_5');
        map.getPane('pane_ResidentialArea_5').style.zIndex = 405;
        map.getPane('pane_ResidentialArea_5').style['mix-blend-mode'] = 'normal';
        var layer_ResidentialArea_5 = new L.geoJson(json_ResidentialArea_5, {
            attribution: '',
            interactive: true,
            dataVar: 'json_ResidentialArea_5',
            layerName: 'layer_ResidentialArea_5',
            pane: 'pane_ResidentialArea_5',
            onEachFeature: pop_ResidentialArea_5,
            style: style_ResidentialArea_5_0,
        });
        bounds_group.addLayer(layer_ResidentialArea_5);
        function pop_UrbanArea_6(feature, layer) {
            layer.on({
                mouseout: function (e) {
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function (feature) {
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(feature.properties['id'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['IsCity'] !== null ? autolinker.link(feature.properties['IsCity'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
            layer.on('popupopen', function (e) {
                addClassToPopupIfMedia(content, e.popup);
            });
            layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_UrbanArea_6_0() {
            return {
                pane: 'pane_UrbanArea_6',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(196,60,57,0.4549019607843137)',
                interactive: true,
            }
        }
        map.createPane('pane_UrbanArea_6');
        map.getPane('pane_UrbanArea_6').style.zIndex = 406;
        map.getPane('pane_UrbanArea_6').style['mix-blend-mode'] = 'normal';
        var layer_UrbanArea_6 = new L.geoJson(json_UrbanArea_6, {
            attribution: '',
            interactive: true,
            dataVar: 'json_UrbanArea_6',
            layerName: 'layer_UrbanArea_6',
            pane: 'pane_UrbanArea_6',
            onEachFeature: pop_UrbanArea_6,
            style: style_UrbanArea_6_0,
        });
        bounds_group.addLayer(layer_UrbanArea_6);
        function pop_Sarawak_7(feature, layer) {
            layer.on({
                mouseout: function (e) {
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function (feature) {
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['ISO3166-2'] !== null ? autolinker.link(feature.properties['ISO3166-2'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['admin_level'] !== null ? autolinker.link(feature.properties['admin_level'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['alt_name'] !== null ? autolinker.link(feature.properties['alt_name'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['boundary'] !== null ? autolinker.link(feature.properties['boundary'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name'] !== null ? autolinker.link(feature.properties['name'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:ar'] !== null ? autolinker.link(feature.properties['name:ar'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:az'] !== null ? autolinker.link(feature.properties['name:az'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:be'] !== null ? autolinker.link(feature.properties['name:be'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:bg'] !== null ? autolinker.link(feature.properties['name:bg'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:bn'] !== null ? autolinker.link(feature.properties['name:bn'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:en'] !== null ? autolinker.link(feature.properties['name:en'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:eo'] !== null ? autolinker.link(feature.properties['name:eo'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:et'] !== null ? autolinker.link(feature.properties['name:et'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:fa'] !== null ? autolinker.link(feature.properties['name:fa'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:he'] !== null ? autolinker.link(feature.properties['name:he'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:hi'] !== null ? autolinker.link(feature.properties['name:hi'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:hy'] !== null ? autolinker.link(feature.properties['name:hy'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:ja'] !== null ? autolinker.link(feature.properties['name:ja'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:ko'] !== null ? autolinker.link(feature.properties['name:ko'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:lt'] !== null ? autolinker.link(feature.properties['name:lt'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:lv'] !== null ? autolinker.link(feature.properties['name:lv'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:mk'] !== null ? autolinker.link(feature.properties['name:mk'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:ml'] !== null ? autolinker.link(feature.properties['name:ml'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:mr'] !== null ? autolinker.link(feature.properties['name:mr'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:ms'] !== null ? autolinker.link(feature.properties['name:ms'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:ms-Arab'] !== null ? autolinker.link(feature.properties['name:ms-Arab'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:my'] !== null ? autolinker.link(feature.properties['name:my'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:nl'] !== null ? autolinker.link(feature.properties['name:nl'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:qu'] !== null ? autolinker.link(feature.properties['name:qu'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:ru'] !== null ? autolinker.link(feature.properties['name:ru'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:sr'] !== null ? autolinker.link(feature.properties['name:sr'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:ta'] !== null ? autolinker.link(feature.properties['name:ta'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:th'] !== null ? autolinker.link(feature.properties['name:th'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:tr'] !== null ? autolinker.link(feature.properties['name:tr'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:uk'] !== null ? autolinker.link(feature.properties['name:uk'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:ur'] !== null ? autolinker.link(feature.properties['name:ur'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name:zh'] !== null ? autolinker.link(feature.properties['name:zh'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['timezone'] !== null ? autolinker.link(feature.properties['timezone'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['type'] !== null ? autolinker.link(feature.properties['type'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['wikidata'] !== null ? autolinker.link(feature.properties['wikidata'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['wikipedia'] !== null ? autolinker.link(feature.properties['wikipedia'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
            layer.on('popupopen', function (e) {
                addClassToPopupIfMedia(content, e.popup);
            });
            layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Sarawak_7_0() {
            return {
                pane: 'pane_Sarawak_7',
                opacity: 1,
                color: 'rgba(255,1,1,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 4.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(133,182,111,0.0)',
                interactive: false,
            }
        }
        map.createPane('pane_Sarawak_7');
        map.getPane('pane_Sarawak_7').style.zIndex = 407;
        map.getPane('pane_Sarawak_7').style['mix-blend-mode'] = 'normal';
        var layer_Sarawak_7 = new L.geoJson(json_Sarawak_7, {
            attribution: '',
            interactive: false,
            dataVar: 'json_Sarawak_7',
            layerName: 'layer_Sarawak_7',
            pane: 'pane_Sarawak_7',
            onEachFeature: pop_Sarawak_7,
            style: style_Sarawak_7_0,
        });
        bounds_group.addLayer(layer_Sarawak_7);
        map.addLayer(layer_Sarawak_7);
        function pop_Districts_8(feature, layer) {
            layer.on({
                mouseout: function (e) {
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function (feature) {
                            feature.closePopup()
                        });
                    }
                },
                click: function (e) {
                    e.target.openPopup();
                }
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">name</th>\
                        <td class="visible-with-data" id="name">' + (feature.properties['name'] !== null ? autolinker.link(feature.properties['name'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">AbsPoverty</th>\
                        <td class="visible-with-data" id="AbsPoverty">' + (feature.properties['AbsPoverty'] !== null ? autolinker.link(feature.properties['AbsPoverty'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Population</th>\
                        <td class="visible-with-data" id="Population">' + (feature.properties['Population'] !== null ? autolinker.link(feature.properties['Population'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">MeanIncome</th>\
                        <td class="visible-with-data" id="MeanIncome">' + (feature.properties['MeanIncome'] !== null ? autolinker.link(feature.properties['MeanIncome'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
            layer.on('popupopen', function (e) {
                addClassToPopupIfMedia(content, e.popup);
            });
            layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Districts_8_0() {
            return {
                pane: 'pane_Districts_8',
                opacity: 1,
                color: 'rgba(53,121,177,1.0)',
                dashArray: '',
                lineCap: 'square',
                lineJoin: 'bevel',
                weight: 3.0,
                fillOpacity: 0,
                interactive: true,
            }
        }
        map.createPane('pane_Districts_8');
        map.getPane('pane_Districts_8').style.zIndex = 408;
        map.getPane('pane_Districts_8').style['mix-blend-mode'] = 'normal';
        var layer_Districts_8 = new L.geoJson(json_Districts_8, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Districts_8',
            layerName: 'layer_Districts_8',
            pane: 'pane_Districts_8',
            onEachFeature: pop_Districts_8,
            style: style_Districts_8_0,
        });
        bounds_group.addLayer(layer_Districts_8);
        map.addLayer(layer_Districts_8);
        function getAddressFromNominatim(lat, lon, callback) {
            const nominatimUrl = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;

            fetch(nominatimUrl)
                .then(response => response.json())
                .then(data => {
                    const address = data.display_name || "";
                    callback(address);
                })
                .catch(error => {
                    console.error("Error fetching address:", error);
                    callback("");
                });
        }

        function pop_Grocery_Retailers_9(feature, layer) {
            layer.on({
                mouseout: function (e) {
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function (feature) {
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">name</th>\
                        <td class="visible-with-data" id="name">' + (feature.properties['name'] !== null ? autolinker.link(feature.properties['name'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
            layer.on('popupopen', function (e) {
                addClassToPopupIfMedia(content, e.popup);
            });
            layer.bindPopup(content, { maxHeight: 400 });

            layer.on('click', function (e) {
                const feature = e.target.feature;
                const name = feature.properties.name || "";
                const lat = feature.geometry.coordinates[1];
                const lon = feature.geometry.coordinates[0];

                getAddressFromNominatim(lat, lon, function (address) {
                    const table = document.getElementById("address-table-content");
                    table.innerHTML = "";
                    const newRow = table.insertRow();
                    const nameCell = newRow.insertCell();
                    const addressCell = newRow.insertCell();
                    const actionCell = newRow.insertCell();

                    nameCell.textContent = name || "Unnamed";
                    addressCell.textContent = address || "Address not found";
                    const link = document.createElement('a');
                    link.href = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}`;
                    link.textContent = "Get Directions";
                    link.target = "_blank";
                    actionCell.appendChild(link);

                });
            });
        }

        function style_Grocery_Retailers_9_0() {
            return {
                pane: 'pane_Grocery_Retailers_9',
                radius: 4.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(183,72,75,1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_Grocery_Retailers_9');
        map.getPane('pane_Grocery_Retailers_9').style.zIndex = 409;
        map.getPane('pane_Grocery_Retailers_9').style['mix-blend-mode'] = 'normal';
        var layer_Grocery_Retailers_9 = new L.geoJson(json_Grocery_Retailers_9, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Grocery_Retailers_9',
            layerName: 'layer_Grocery_Retailers_9',
            pane: 'pane_Grocery_Retailers_9',
            onEachFeature: pop_Grocery_Retailers_9,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.circleMarker(latlng, style_Grocery_Retailers_9_0(feature));
            },
        });
        bounds_group.addLayer(layer_Grocery_Retailers_9);
        map.addLayer(layer_Grocery_Retailers_9);
        var baseMaps = {};
        var overlaysTree = [
            { label: '<img src="legend/Grocery_Retailers_9.png" /> Grocery_Retailers', layer: layer_Grocery_Retailers_9 },
            { label: '<img src="legend/Districts_8.png" /> Districts', layer: layer_Districts_8 },
            { label: '<img src="legend/Sarawak_7.png" /> Sarawak', layer: layer_Sarawak_7 },
            { label: '<img src="legend/UrbanArea_6.png" /> UrbanArea', layer: layer_UrbanArea_6 },
            { label: '<img src="legend/ResidentialArea_5.png" /> ResidentialArea', layer: layer_ResidentialArea_5 },
            { label: 'Populations<br /><table><tr><td style="text-align: center;"><img src="legend/Populations_4_81890.png" /></td><td>8 - 18.9</td></tr><tr><td style="text-align: center;"><img src="legend/Populations_4_1892461.png" /></td><td>18.9 - 24.6</td></tr><tr><td style="text-align: center;"><img src="legend/Populations_4_2463672.png" /></td><td>24.6 - 36.7</td></tr><tr><td style="text-align: center;"><img src="legend/Populations_4_3675713.png" /></td><td>36.7 - 57.1</td></tr><tr><td style="text-align: center;"><img src="legend/Populations_4_57162174.png" /></td><td>57.1 - 621.7</td></tr></table>', layer: layer_Populations_4 },
            { label: 'Income<br /><table><tr><td style="text-align: center;"><img src="legend/Income_3_321840020.png" /></td><td>3218 - 4002</td></tr><tr><td style="text-align: center;"><img src="legend/Income_3_400243681.png" /></td><td>4002 - 4368</td></tr><tr><td style="text-align: center;"><img src="legend/Income_3_436848812.png" /></td><td>4368 - 4881</td></tr><tr><td style="text-align: center;"><img src="legend/Income_3_488156213.png" /></td><td>4881 - 5621</td></tr><tr><td style="text-align: center;"><img src="legend/Income_3_562196454.png" /></td><td>5621 - 9645</td></tr></table>', layer: layer_Income_3 },
            { label: 'Poverty<br /><table><tr><td style="text-align: center;"><img src="legend/Poverty_2_2160.png" /></td><td>2.1 - 6</td></tr><tr><td style="text-align: center;"><img src="legend/Poverty_2_6961.png" /></td><td>6 - 9.6</td></tr><tr><td style="text-align: center;"><img src="legend/Poverty_2_961362.png" /></td><td>9.6 - 13.6</td></tr><tr><td style="text-align: center;"><img src="legend/Poverty_2_136203.png" /></td><td>13.6 - 20</td></tr><tr><td style="text-align: center;"><img src="legend/Poverty_2_203864.png" /></td><td>20 - 38.6</td></tr></table>', layer: layer_Poverty_2 },
            { label: "HeatMap(Food Desert)", layer: layer_HeatMapFoodDesert_1 },
            { label: "OpenStreetMap", layer: layer_OpenStreetMap_0 },]
        var lay = L.control.layers.tree(null, overlaysTree, {
            //namedToggle: true,
            //selectorBack: false,
            //closedSymbol: '&#8862; &#x1f5c0;',
            //openedSymbol: '&#8863; &#x1f5c1;',
            //collapseAll: 'Collapse all',
            //expandAll: 'Expand all',
            collapsed: false,
        });
        lay.addTo(map);
        document.addEventListener("DOMContentLoaded", function () {
            // set new Layers List height which considers toggle icon
            function newLayersListHeight() {
                var layerScrollbarElement = document.querySelector('.leaflet-control-layers-scrollbar');
                if (layerScrollbarElement) {
                    var layersListElement = document.querySelector('.leaflet-control-layers-list');
                    var originalHeight = layersListElement.style.height
                        || window.getComputedStyle(layersListElement).height;
                    var newHeight = parseFloat(originalHeight) - 50;
                    layersListElement.style.height = newHeight + 'px';
                }
            }
            var isLayersListExpanded = true;
            var controlLayersElement = document.querySelector('.leaflet-control-layers');
            var toggleLayerControl = document.querySelector('.leaflet-control-layers-toggle');
            // toggle Collapsed/Expanded and apply new Layers List height
            toggleLayerControl.addEventListener('click', function () {
                if (isLayersListExpanded) {
                    controlLayersElement.classList.remove('leaflet-control-layers-expanded');
                } else {
                    controlLayersElement.classList.add('leaflet-control-layers-expanded');
                }
                isLayersListExpanded = !isLayersListExpanded;
                newLayersListHeight()
            });
            // apply new Layers List height if toggle layerstree
            if (controlLayersElement) {
                controlLayersElement.addEventListener('click', function (event) {
                    var toggleLayerHeaderPointer = event.target.closest('.leaflet-layerstree-header-pointer span');
                    if (toggleLayerHeaderPointer) {
                        newLayersListHeight();
                    }
                });
            }
            // Collapsed/Expanded at Start to apply new height
            setTimeout(function () {
                toggleLayerControl.click();
            }, 10);
            setTimeout(function () {
                toggleLayerControl.click();
            }, 10);
            // Collapsed touch/small screen
            var isSmallScreen = window.innerWidth < 650;
            if (isSmallScreen) {
                setTimeout(function () {
                    controlLayersElement.classList.remove('leaflet-control-layers-expanded');
                    isLayersListExpanded = !isLayersListExpanded;
                }, 500);
            }
        });
        setBounds();
        var i = 0;
        layer_Districts_8.eachLayer(function (layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['name'] !== null ? String('<div style="color: #0091ca; font-size: 10pt; font-style: italic; font-family: \'Cambria\', sans-serif;">' + layer.feature.properties['name']) + '</div>' : ''), { permanent: true, offset: [-0, -16], className: 'css_Districts_8' });
            labels.push(layer);
            totalMarkers += 1;
            layer.added = true;
            addLabel(layer, i);
            i++;
        });
        L.ImageOverlay.include({
            getBounds: function () {
                return this._bounds;
            }
        });
        resetLabels([layer_Districts_8]);
        map.on("zoomend", function () {
            resetLabels([layer_Districts_8]);
        });
        map.on("layeradd", function () {
            resetLabels([layer_Districts_8]);
        });
        map.on("layerremove", function () {
            resetLabels([layer_Districts_8]);
        });

        var bounds = [[0.14735230926146703, 108.18141465546034], [5.32862001331641, 117.2980911773162]];
        map.setMaxBounds(bounds);
        map.on('drag', function () {
            map.panInsideBounds(bounds);
        });

        function isNodeVisible(node) {
            var mapBounds = map.getBounds();
            return mapBounds.contains(node.getLatLng());
        }

        function debounce(func, delay) {
            let timeoutId;
            return function (...args) {
                if (timeoutId) {
                    clearTimeout(timeoutId);
                }
                timeoutId = setTimeout(() => {
                    func.apply(null, args);
                }, delay);
            };
        }

        let currentTableData = [];

        function updateVisibleNodes() {
            var visibleNodes = layer_Grocery_Retailers_9.getLayers().filter(function (node) {
                return isNodeVisible(node);
            }).slice(0, 5);

            const table = document.getElementById("address-table-content");

            const newTableData = [];

            if (visibleNodes.length === 0) {
                newTableData.push({ name: "NA", address: "NA", link: "#" });
            } else {
                visibleNodes.forEach(function (node) {
                    const lat = node.getLatLng().lat;
                    const lon = node.getLatLng().lng;

                    getAddressFromNominatim(lat, lon, function (address) {
                        const name = node.feature.properties.name || "";
                        const link = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lon}`;
                        newTableData.push({ name, address: address || "Address not found", link });

                        if (newTableData.length === visibleNodes.length) {
                            updateTable(table, newTableData);
                        }
                    });
                });
            }
        }

        function updateTable(table, newTableData) {
            const isSame = JSON.stringify(newTableData) === JSON.stringify(currentTableData);

            if (!isSame) {
                table.innerHTML = "";

                currentTableData = newTableData;

                newTableData.forEach(data => {
                    const newRow = table.insertRow();
                    const nameCell = newRow.insertCell();
                    const addressCell = newRow.insertCell();
                    const actionCell = newRow.insertCell();

                    nameCell.textContent = data.name;
                    addressCell.textContent = data.address;

                    const link = document.createElement('a');
                    link.href = data.link;
                    link.textContent = "Get Directions";
                    link.target = "_blank";

                    actionCell.appendChild(link);
                });
            }
        }

        map.on('moveend', debounce(updateVisibleNodes, 1000));
    </script>
</body>

</html>